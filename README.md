# VSiM

## はじめに

VSiMは、Vimの操作感をベースにした、無限にスクロールできるメモ・日記アプリです。
日ごとのMarkdownファイルをシームレスに結合し、途切れることなく書き続けることができます。

※ 現在はプロトタイプ版として、実行ファイルのみを先行公開しています。
※ あくまで、**自分のために**作ったものです。

## インストール方法

右側の「Releases」ページから、お使いのOSに合ったインストーラーをダウンロードし、実行してください。

## 画面構成 (UI Overview)

![アプリのスクリーンショット](screenshot.png)

1. **ヘッダーバー**:
* **ファイル名**: 現在カーソルがある位置のファイル名を表示します。未保存の変更がある場合は文字色が変わり、`*` が付きます。


2. **エディタエリア**:
* **行番号**: カーソル行からの相対行番号を表示（Vimスタイル）。現在行は `›` で示されます。
* **セパレーター**: 日付の変わり目には `--- YYYY-MM-DD.md ---` という区切り線が表示されます。


3. **フッターバー**:
* **Vimモード**: 現在のモード（NORMAL / INSERT / VISUAL / REPLACE）を色付きで表示します。
* **IMEステータス**: 入力モードの状態（`A` / `あ`）を表示します。
* **カーソル位置情報**: 現在の日付セクション内の行数情報を表示します。
* **キーストローク**: 直近に入力したキー履歴を表示します（Vim操作の確認用）。



## 基本操作

基本的な操作は、テキストエディタ「Vim」のキーバインドに準拠しています。

### モードについて

* **Normalモード** (起動時)
* `h`, `j`, `k`, `l`: カーソル移動
* `:`: コマンドモードへ移行（下部にコマンドパネルが開きます）
* `i`, `a`, `o`: Insertモード（入力）へ移行


* **Insertモード**
* 文字を入力するためのモードです。
* `Esc` または `Ctrl + j`: Normalモードに戻る



### 独自のキーバインド (Modern Keymaps)

現代的なエディタの操作感に合わせ、以下のショートカットを追加しています。OSのクリップボードとシームレスに連携します。

| キー | モード | 動作 |
| --- | --- | --- |
| `Ctrl` + `c` | Visual | **OSのクリップボードにコピー** (標準のVimレジスタではなくOS側にコピーします) |
| `Ctrl` + `c` | Normal | 現在行をOSのクリップボードにコピー |
| `Ctrl` + `v` | Normal / Insert | **OSのクリップボードから貼り付け** |
| `gx` | Normal | カーソル下のURLをブラウザで開く |
| `gi` | Normal | カーソル下の画像パスをビューアーで開く |
| `gl` | Normal | カーソル下のURLをMarkdownリンク形式 `[](url)` に変換し、タイトル入力待ちにする |

## 鉄壁のIME制御 (Smart IME Control)

VSiM最大の特徴です。Vim操作における「日本語入力がONのままコマンドを打ってしまう（いわゆる『日本語入力ゾンビ』問題）」を、OSレベルの制御で解決しています。

1. **モード連動切り替え**:
* Insertモードから `Esc` で抜けると、**自動的にIMEがOFF**になります。
* Rustバックエンドが親ウィンドウまで遡ってIMEコンテキストを制御するため、WebView特有の制御漏れがありません。


2. **Normalモード保護 (Nuclear Reset)**:
* Normalモード中にうっかり「半角/全角」キーを押したり、日本語入力を開始してしまっても、アプリが即座に検知。
* **強制的にIMEをOFFにし、フォーカスを一瞬リセット**することで、予測変換ウィンドウごとかき消します。


3. **視認性**:
* フッターのインジケーターが、IMEの状態に合わせてリアルタイムに変化します。
* **`A` (グレー)**: 半角英数モード。Vimコマンド入力OK。
* **`あ` (オレンジ・発光)**: 日本語入力モード。



## コマンド一覧

Normalモードで `:` を押すとコマンドラインが表示され、以下のコマンドが実行できます。

| コマンド | 短縮 | 機能 | 備考 |
| --- | --- | --- | --- |
| `:write` | `:w` | **保存** | 現在の変更を即座に保存します。（アプリは自動保存も行います） |
| `:quit` | `:q` | **終了** | アプリを終了します。未保存の変更がある場合は保存するか尋ねます。 |
| `:edit` | `:e` | **ファイル移動** | ファイルパレットを開き、指定した日付（ファイル）へジャンプします。 |
| `:open` |  | **ファイル移動** | `:e` と同じ機能です。 |
| `:tag <名前>` | `:t` | **タグ作成** | カーソル位置の段落、または選択範囲を `:::名前` 〜 `:::` で囲み、タグ化します。 |
| `:ts` | `:ts` | **タグ検索** | 全ファイルからタグを検索します。結果はSplit Viewで表示されます。 |
| `:limit <行数>` | `:l` | **行数制限設定** | メモリ解放のしきい値（行数）を一時的に変更します。デフォルトは自動計算されます。 |
| `:vsplit` | `:vs` | **縦分割** | 画面を左右に分割し、別のファイルを開きます。 |
| `:split` | `:sp` | **横分割** | 画面を上下に分割し、別のファイルを開きます。 |
| `:only` | `:on` | **分割解除** | 分割されたウィンドウを閉じ、メインエディタのみに戻します。 |
| `:img` |  | **画像挿入** | 画像ファイルを選択し、プロジェクト内の `images/` に保存して挿入します。 |
| `:openurl` |  | **URLを開く** | カーソル下のURLを標準ブラウザで開きます。<br>

<br> ショートカット: **`gx`** |
| `:viewimage` |  | **画像を開く** | カーソル下の画像パスを標準ビューアーで開きます。<br>

<br> ショートカット: **`gi`** |
| `:mklink` |  | **リンク整形** | カーソル位置のURLを `[](URL)` 形式に変換し、タイトル入力待ちにします。<br>

<br> ショートカット: **`gl`** |

## 主な機能

### 1. 無限スクロール (Infinite Scroll)

画面の一番上までスクロールすると「前日のメモ」が、一番下までいくと「翌日のメモ」が自動で読み込まれ、結合されます。ページを切り替える手間なく、過去や未来を行き来できます。
ファイル同士の境界線には `--- YYYY-MM-DD.md ---` というヘッダーが表示されます。

### 2. 高速タグ検索システム (Tag Search)

`:t <名前>` コマンドで作成したタグ（`:::tagname` 形式）は、起動時に全スキャンされキャッシュされます。
`:ts` コマンドを使うことで、大量のファイルの中から一瞬で目的のトピックを探し出し、別画面（Split View）で一覧表示・ジャンプすることができます。

### 3. スマートメモリ管理 (Auto Pruning)

アプリの軽快さを保つため、読み込んだデータが設定された行数（Limit）を超えると、画面から一番遠い日付のデータが自動的にメモリから削除されます。
削除されるデータに変更があった場合は、自動的に保存されてからメモリから消えるため、書いた内容が失われることはありません。

しきい値は現在の行数に応じて自動計算されますが、`:limit` コマンドで手動変更することも可能です。

### 4. 安全装置 (Cursor Guard)

編集中（カーソルがある場所）のデータは、自動削除の対象になりません。
もしカーソルがある場所が削除対象になった場合は、処理が一時的に「保留（Pending）」されます。その後、編集作業が終わってカーソルを安全な場所に移動させた瞬間にメモリ整理が実行されます。
書いている途中で勝手に文字が消えることはありませんので、ご安心ください。

### 5. スマートプレビュー & メディア管理 (Smart Media)

テキストエディタでありながら、リッチなメディア体験を提供します。

* **即時プレビュー**: URLや画像パスの上にカーソルを置くだけで、ツールチップによるプレビューが表示されます。
* **Webリンク**: ページのタイトルやOGP画像を取得してカード表示します。
* **YouTube**: 動画サムネイルが表示され、内容が一目でわかります。
* **ローカル画像**: リンク先の画像をその場でポップアップ表示します。


* **ドラッグ&ドロップ**: 画像ファイルをエディタにドロップすると、自動的にプロジェクト内の `images` フォルダへコピーされ、Markdown形式 `![image](path)` で挿入されます。

## その他・Tips

* **Vim完全対応**: 無限スクロールの境界付近でも、`j` / `k` キーによる移動や読み込みがスムーズに行えるよう調整されています。
* **現在行表示**: 現在カーソルがある行は、行番号の代わりに `›` という記号で表示されます。
* **未保存マーク**: 変更があり未保存の場合は、ヘッダーの日付横に `*` マークが付きます。

## 免責事項

本アプリは開発中のプロトタイプです。予期せぬバグが含まれている可能性があります。
使用によって生じたデータの損失や不利益について、開発者は責任を負いかねます。
大切なデータはこまめにバックアップを取ることをおすすめします。

---

**命名由来**
V:Vim-based, S:Scrollable, i:infinite, M:Memo, VS:VSCode-like(Design), SiM:Simple
